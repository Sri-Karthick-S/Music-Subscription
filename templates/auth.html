{% extends 'base.html' %}
{% block content %}

<div class="auth-container">

  <!-- LEFT: Brand & Slogan -->
  <div class="auth-left">
    <div class="brand-header">
      <h1 class="brand-title">Melodify Music Subscription</h1>
      <p class="brand-subtitle">Where music meets your vibe ðŸŽ¶</p>
    </div>
  </div>

  <!-- RIGHT: Login/Register Flip Card -->
  <div class="auth-right">
    <div class="flip-container"  id="flip-box">
      <div class="flipper">

        <!-- FRONT: LOGIN -->
        <div class="front">
          <div class="card login-card">
            <h2 class="login-title">Login</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="flash-container">
                  {% for category, message in messages %}
                    {% if category.startswith('login') %}
                      <div class="flash flash-{{ category.split('-')[1] }}">{{ message }}</div>
                    {% endif %}
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('login') }}" class="login-form">
              <label>Email</label>
              <input type="email" name="email" placeholder="Enter your email" value="{{ email if email is defined else '' }}" required>

              <label>Password</label>
              <input type="password" name="password" placeholder="Enter password" required>
              <button type="submit" class="login-btn">Login</button>
            </form>

            <p class="register-link">Don't have an account? <a href="#" onclick="flipCard(true)">Register</a></p>
          </div>
        </div>

        <!-- BACK: REGISTER -->
        <div class="back">
          <div class="card login-card">
            <h2 class="register-title">Register</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="flash-container">
                  {% for category, message in messages %}
                    {% if category.startswith('register') %}
                      <div class="flash flash-{{ category.split('-')[1] }}">{{ message }}</div>
                    {% endif %}
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('register') }}" class="login-form">
              <label>Email</label>
              <input type="email" name="email" required>
              <label>Username</label>
              <input type="text" name="username" required>
              <label>Password</label>
              <input type="password" name="password" required>
              <button type="submit" class="login-btn">Register</button>
            </form>

            <p class="register-link">Already have an account? <a href="#" onclick="flipCard(false)">Login</a></p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  
  function flipCard(toRegister) {
    const box = document.getElementById('flip-box');
    if (toRegister) {
      box.classList.add('flipped');
      sessionStorage.setItem('form_type', 'register');
    } else {
      box.classList.remove('flipped');
      sessionStorage.setItem('form_type', 'login');
    }
  }

  // ðŸ§  Apply saved state on page load (to prevent unwanted flip back)
  window.onload = function () {
    const formType = sessionStorage.getItem('form_type') || 'login';
    const box = document.getElementById('flip-box');
    if (formType === 'register') {
      box.classList.add('flipped');
    } else {
      box.classList.remove('flipped');
    }
  };
</script>


{% endblock %}
