{% extends 'base.html' %}
{% block content %}
<div class="container">

  <!-- HEADER -->
  <header class="header-row">
    <div class="brand-header">
      <h1 class="brand-title">Melodify Music Subscription</h1>
      <p class="brand-subtitle">Where music meets your vibe ðŸŽ¶</p>
    </div>
    <div class="user-area">
      Welcome, ðŸ‘‹ <span class="user-name">
        <strong>{{ user_name }}</strong>
      </span>
      <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </div>
  </header>
  <!-- MAIN WRAPPER -->
  <div class="main-content">
    <!-- LEFT: SUBSCRIPTIONS AREA -->
    <section class="subscription-section">
      <h2 class="subscription-title">Your Subscriptions</h2>
      <div class="subscription-scrollable">
        {% if subscriptions and subscriptions|length > 0 %}
        <div class="subscription-list">
          {% for sub in subscriptions %}
          <div class="music-card">
            <div class="music-info">
              <h3>{{ sub.title }}</h3>
              <p><strong>Artist:</strong> {{ sub.artist }}</p>
              <p><strong>Album:</strong> {{ sub.album }}</p>
              <p><strong>Year:</strong> {{ sub.year }}</p>
            </div>
            <img src="{{ sub.image_url }}" class="artist-image" alt="Artist Image">
            <form action="{{ url_for('remove_subscription_route') }}" method="post">
              <input type="hidden" name="title_album" value="{{ sub.title_album }}">
              <button class="remove-btn">Remove</button>
            </form>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="subscription-empty">No subscriptions yet.</div>
        {% endif %}
      </div>
    </section>

    <!-- RIGHT: SEARCH + RESULTS -->
    <section class="query-section">
      <h2 class="subscription-title">Find Music</h2>

      <!-- SEARCH FORM -->
      <form class="query-form" method="post" action="{{ url_for('main') }}">
        <div class="form-grid">
          <input type="text" name="title" placeholder="Title " value="{{ session['last_search']['title'] if session.get('last_search') else '' }}">
          <input type="text" name="year" placeholder="Year" value="{{ session['last_search']['year'] if session.get('last_search') else '' }}">
          <input type="text" name="album" placeholder="Album" value="{{ session['last_search']['album'] if session.get('last_search') else '' }}">
          <input type="text" name="artist" placeholder="Artist" value="{{ session['last_search']['artist'] if session.get('last_search') else '' }}">
        </div>
        <button type="submit" class="query-btn">Search</button>
      </form>

      <!-- QUERY RESULTS -->
      <div class="query-results">
        {% if results and results|length > 0 %}
        <div class="results-list">
          {% for res in results %}
          <div class="music-card horizontal-card">
            <div class="music-text">
              <h3>{{ res.title }}</h3>
              <p><strong>Artist:</strong> {{ res.artist }}</p>
              <p><strong>Album:</strong> {{ res.album }}</p>
              <p><strong>Year:</strong> {{ res.year }}</p>
              {% if not res.subscribed %}
              <form action="{{ url_for('subscribe') }}" method="post">
                <input type="hidden" name="title_album" value="{{ res.title_album }}">
                <input type="hidden" name="title" value="{{ res.title }}">
                <input type="hidden" name="artist" value="{{ res.artist }}">
                <input type="hidden" name="album" value="{{ res.album }}">
                <input type="hidden" name="year" value="{{ res.year }}">
                <input type="hidden" name="s3_key" value="{{ res.s3_key }}">
                <button type="submit" class="subscribe-btn">Subscribe</button>
              </form>
              {% else %}
              <p class="already-subscribed-label">Already subscribed</p>
              {% endif %}
            </div>
            <img src="{{ res.image_url }}" alt="Artist Image" class="artist-image horizontal-img">
          </div>
          {% endfor %}
        </div>
        {% elif query_performed %}
        <div class="no-result">No results. Try again.</div>
        {% endif %}
      </div>
    </section>
  </div>
</div>
{% endblock %}
